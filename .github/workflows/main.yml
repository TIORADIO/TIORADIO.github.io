name: Generar Noticias

on:
  push:
    branches: [ main ]

jobs:
  generar:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        uses: actions/checkout@v2

      - name: set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      - name: install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install beautifulsoup4

      - name: generar noticias
        run: |
          for file in ${GITHUB_WORKSPACE}/generador/*.html
          do
            filename=$(basename -- "$file")
            filename="${filename%.*}"
            cp ${GITHUB_WORKSPACE}/plantilla/plantilla.html ${GITHUB_WORKSPACE}/noticias/"$filename".html
            fecha=$(cat "$file" | grep -oP '(?<=<fecha>).*?(?=</fecha>)')
            titulo=$(cat "$file" | grep -oP '(?<=<titulo>).*?(?=</titulo>)')
            genero=$(cat "$file" | grep -oP '(?<=<genero>).*?(?=</genero>)')
            autor=$(cat "$file" | grep -oP '(?<=<autor>).*?(?=</autor>)')
            contenido=$(cat "$file" | grep -oP '(?<=<contenido>).*?(?=</contenido>)')
            sed -i "s/Fecha de la noticia/$fecha/" ${GITHUB_WORKSPACE}/noticias/"$filename".html
            sed -i "s/Título de la noticia/$titulo/" ${GITHUB_WORKSPACE}/noticias/"$filename".html
            sed -i "s/Género de la noticia/$genero/" ${GITHUB_WORKSPACE}/noticias/"$filename".html
            sed -i "s/Autor de la noticia/$autor/" ${GITHUB_WORKSPACE}/noticias/"$filename".html
            sed -i "s/noticia aquí/$contenido/" ${GITHUB_WORKSPACE}/noticias/"$filename".html
            echo "Noticia generada para $filename.html"
          done
